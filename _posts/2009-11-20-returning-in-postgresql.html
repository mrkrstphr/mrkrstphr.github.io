---
layout: post
title: Returning in PostgreSQL
excerpt: The less queries, the better, amirite?
categories:
- Database
tags:
- PostgreSQL
status: publish
type: post
published: true
meta:
  _edit_last: '2'
  _jd_twitter: ''
  _jd_tweet_this: 'yes'
  _wp_jd_clig: ''
  _wp_jd_bitly: ''
  _wp_jd_wp: ''
  _wp_jd_yourls: ''
  _wp_jd_url: ''
  _wp_jd_target: ''
  _jd_wp_twitter: ''
  _jd_post_meta_fixed: 'true'
---
I recently came across an amazing feature in PostgreSQL: the <code>RETURNING</code> clause. This clause allows you to return specific data as the result of an <code>INSERT</code> or <code>UPDATE</code> query.

Often, after doing one of these queries, I'm interested in getting some data, such as an autogenerated primary key field, or maybe some defaulted data (like a created timestamp). Normally, one would have to do an additional query to get this data. Using <code>RETURNING</code>, we can do our data manipulation and retrieval in the same query.

Example:

<pre class="prettyprint language-sql">-- Return just the ID:

INSERT INTO books(name, author) VALUES('Awesome Book', 'Smart Author')
    RETURNING book_id;

-- Return more than one column:

INSERT INTO books(name, author) VALUES ('Sweet Book', 'Other Author')
    RETURNING book_id, created_on;

-- Return all the columns:

INSERT INTO books(name, author) VALUES ('Silly Book', 'Airhead Author')
    RETURNING *;</pre>

In our code, we can simply treat the return value of the <code>INSERT</code> or <code>UPDATE</code> code like we would a <code>SELECT</code> statement.

Some things to keep in mind, though:

<ol>
    <li>If the <code>UPDATE</code> query affects multiple rows, multiple rows of data will be returned. If no rows are affected, none will be returned.</li>
    <li>Normally the database would return the number of rows affected, but obviously we're overriding the return value of the query. Obviously we can check the number of rows returned by the query (like we would with a <code>SELECT</code>) to get around this.</li>
</ol>
